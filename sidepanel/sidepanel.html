<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pawz Sidepanel</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- HEADER -->
    <header class="w-header">
      <div class="brand-area">
        <img src="../assets/logo.svg" alt="Pawz" class="logo-icon" />
        <span class="brand-name">Pawz</span>
      </div>
      <div class="actions-area">
        <button id="btn-settings" class="icon-btn" title="Param√®tres">‚öôÔ∏è</button>
      </div>
    </header>

    <!-- NAVIGATION TABS -->
    <div class="nav-tabs">
      <div id="tab-search" class="nav-item active">Recherche</div>
      <div id="tab-analysis" class="nav-item">Analyse</div>
    </div>

    <!-- BODY -->
    <div class="w-body">

      <!-- ============================================ -->
      <!-- VUE ONGLET : RECHERCHE (Gestion des Mandats) -->
      <!-- ============================================ -->
      <div id="view-search">

        <!-- SOUS-VUE 1 : LISTE DES JOBS -->
        <div id="jobs-list-view">
            <div class="jobs-list-header">
                <h3>Mes recherches</h3>
                <button id="btn-create-job" class="btn-create">+ Nouvelle</button>
            </div>
            <div id="jobs-container" class="jobs-scroll-area">
                <!-- Inject√© par JS -->
            </div>
        </div>

        <!-- SOUS-VUE 2 : √âDITION JOB -->
        <div id="job-edit-view" class="hidden">
            <div class="edit-nav">
                <button id="btn-back-jobs" class="back-link">‚Üê Retour</button>
            </div>

            <!-- BLOC FORMULAIRE -->
            <div id="job-form-section">
                <div class="input-group">
                    <input type="text" id="job-title-input" class="job-title-input" placeholder="Titre du poste...">
                </div>
                <div class="input-group">
                  <div class="label-row">
                    <label class="input-label">üìù Fiche de Poste</label>
                    <div class="label-tools">
                        <button id="btn-undo-form" class="mini-btn" title="R√©tablir la version enregistr√©e">‚Ü©</button>
                        <button id="btn-clear-form" class="mini-btn" title="Vider le contenu">üîÑ</button>
                    </div>
                  </div>
                  <textarea id="brief-text" class="styled-textarea" placeholder="Collez la description du poste ici..."></textarea>
                </div>
                <div class="input-group">
                  <label class="input-label" style="color: #F97316;">‚õî Crit√®res Obligatoires</label>
                  <div class="skill-adder">
                    <input id="must-input" type="text" class="skill-input" placeholder="Ajouter...">
                    <button id="btn-add-must" class="add-btn">+</button>
                  </div>
                  <div id="must-tags" class="skill-tags"></div>
                </div>
                <div class="input-group">
                  <label class="input-label" style="color: #10b981;">‚ú® Les Plus</label>
                  <div class="skill-adder">
                    <input id="nice-input" type="text" class="skill-input" placeholder="Ajouter...">
                    <button id="btn-add-nice" class="add-btn">+</button>
                  </div>
                  <div id="nice-tags" class="skill-tags"></div>
                </div>
                <div class="save-container">
                  <button id="btn-save-search" class="btn-main primary">Enregistrer</button>
                </div>
            </div>

            <!-- SECTIONS ADDITIONNELLES (√âdition seulement) -->
            <div id="job-extra-sections" class="hidden">
                
                <!-- BLOC COMPRENDRE LE BESOIN -->
                <div class="section-divider"></div>
                <div id="understand-block" class="understand-card">
                    <div class="understand-header">
                        <span class="understand-icon">üß†</span>
                        <span class="understand-title">Comprendre le besoin</span>
                    </div>
                    <!-- √âtat 1: Pas encore analys√© -->
                    <div id="understand-empty" class="understand-cta">
                        <p>L'IA peut analyser votre fiche de poste pour mieux scorer les candidats.</p>
                        <button id="btn-understand" class="btn-understand">Analyser ma fiche de poste</button>
                    </div>
                    <!-- √âtat 2: Analyse disponible (Accordion) -->
                    <div id="understand-result" class="understand-result hidden">
                        <div class="accordion open">
                            <div class="accordion-header">
                                <span>üìã R√©sum√© de l'analyse</span>
                                <div class="header-chevron">‚ñº</div>
                            </div>
                            <div class="accordion-content">
                                <p id="understand-summary">Analyse g√©n√©r√©e par l'IA...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BLOC ANALYSES ASSOCI√âES -->
                <div class="section-divider"></div>
                <div id="job-candidates-section">
                    <h4 class="section-title">Analyses associ√©es</h4>
                    <div id="job-candidates-list" class="candidates-container mini">
                        <!-- Inject√© par JS -->
                    </div>
                </div>

            </div>
        </div>
      </div>

      <!-- ============================================ -->
      <!-- VUE ONGLET : ANALYSE (Liste Candidats)       -->
      <!-- ============================================ -->
      <div id="view-analysis" class="hidden">
        <div id="active-job-banner" class="active-job-banner hidden">
            <span>üî¥ Job actif : <b id="banner-job-title">Aucun</b></span>
        </div>
        
        <!-- BARRE DE RECHERCHE & FILTRES -->
        <div class="search-filters-bar">
            <div class="search-input-wrapper">
                <span class="search-icon">üîç</span>
                <input type="text" id="search-candidates" class="search-input" placeholder="Rechercher un candidat...">
                <button id="btn-clear-search" class="btn-clear-search hidden">√ó</button>
            </div>
            <div class="filter-pills">
                <button class="filter-pill" data-filter="score80" title="Score ‚â• 80%">‚≠ê Top</button>
                <select id="filter-job" class="filter-select">
                    <option value="">Toutes les fiches</option>
                </select>
                <select id="filter-model" class="filter-select">
                    <option value="">Tous les mod√®les</option>
                    <option value="fast">‚ö° Flash</option>
                    <option value="pro">üß† Pro</option>
                </select>
                <select id="filter-tuning" class="filter-select">
                    <option value="">Tous les r√©glages</option>
                </select>
            </div>
        </div>
        
        <div class="queue-stats">
          <span class="stat-badge">‚è≥ <span id="count-pending">0</span></span>
          <span class="stat-badge">‚úÖ <span id="count-done">0</span></span>
          <span class="stat-badge filter-info hidden" id="filter-info">üîé <span id="count-filtered">0</span> r√©sultats</span>
        </div>
        <div id="candidates-list" class="candidates-container">
          <div class="empty-state"><p>Aucun candidat.</p></div>
        </div>
      </div>

    </div>

    <!-- DETAIL OVERLAY (Candidat) -->
    <div id="detail-overlay" class="detail-panel hidden">
      <div class="detail-nav">
        <button id="btn-close-detail" class="back-btn">‚Üê Retour</button>
      </div>
      <div class="analysis-content">
        <div class="analysis-scroll-area">
            <!-- 1. EN-T√äTE PROFIL -->
            <div class="header-profile" style="text-align:center; margin-bottom:20px;">
                <div id="detail-initials" class="avatar-large" style="width:60px; height:60px; border-radius:50%; background:#f3f4f6; color:#374151; font-size:24px; font-weight:700; display:flex; align-items:center; justify-content:center; margin:0 auto 10px auto;">--</div>
                <h3 id="detail-candidate-name" style="margin:0; font-size:18px; font-weight:700; color:#111;">Nom Candidat</h3>
                <p id="detail-candidate-title" style="margin:4px 0 0 0; font-size:13px; color:#6b7280;">Titre d√©tect√©</p>
            </div>
            <!-- 2. SCORE & VERDICT -->
            <div style="text-align: center; margin-bottom: 24px;">
                <div id="detail-score" class="score-display" style="font-size:48px; font-weight:800; color:#111; line-height:1;">--%</div>
                <div id="detail-verdict" class="verdict-badge" style="display:inline-block; margin-top:8px; padding:4px 12px; border-radius:20px; background:#f3f4f6; color:#6b7280; font-size:13px; font-weight:600;">En attente</div>
            </div>
            <!-- 3. ACCORD√âON : POINTS FORTS (ouvert par d√©faut) -->
            <div class="accordion open">
                <div class="accordion-header">
                    <span>‚úÖ Points Forts</span>
                    <div class="header-chevron">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                    </div>
                </div>
                <div class="accordion-content">
                    <ul id="detail-strengths" class="list-check" style="margin: 0; padding-left: 20px;">
                        <li>Analyse en cours...</li>
                    </ul>
                </div>
            </div>
            <!-- 4. ACCORD√âON : VIGILANCE (ouvert par d√©faut) -->
            <div class="accordion open">
                <div class="accordion-header">
                    <span style="color: #F97316;">‚ö†Ô∏è Points de Vigilance</span>
                    <div class="header-chevron">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                    </div>
                </div>
                <div class="accordion-content">
                    <ul id="detail-warnings" class="list-warn" style="margin: 0; padding-left: 20px;">
                        <li>Aucune donn√©e.</li>
                    </ul>
                </div>
            </div>
            <!-- 5. ACCORD√âON : R√âSUM√â (ferm√© par d√©faut) -->
            <div class="accordion">
                <div class="accordion-header">
                    <span>ü§ñ R√©sum√© D√©taill√©</span>
                    <div class="header-chevron">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                    </div>
                </div>
                <div class="accordion-content">
                    <p id="detail-summary" style="white-space: pre-line; margin:0; font-size:13px; line-height:1.5; color:#4b5563;">Le r√©sum√© appara√Ætra ici.</p>
                </div>
            </div>
            
            <!-- 6. CONTEXTE DE L'ANALYSE -->
            <div class="analysis-context-card">
                <div class="context-title">üìã Contexte de l'analyse</div>
                <div class="context-grid">
                    <div class="context-item">
                        <span class="context-label">Fiche de poste</span>
                        <span id="detail-job-title" class="context-value">-</span>
                    </div>
                    <div class="context-item">
                        <span class="context-label">Mod√®le IA</span>
                        <span id="detail-model" class="context-value">-</span>
                    </div>
                    <div class="context-item">
                        <span class="context-label">R√©glage</span>
                        <span id="detail-tuning" class="context-value">-</span>
                    </div>
                    <div class="context-item context-url">
                        <span class="context-label">URL Source</span>
                        <a id="detail-source-url" class="context-value link" href="#" target="_blank" title="Ouvrir dans un nouvel onglet">-</a>
                    </div>
                </div>
            </div>
            
            <div style="height:40px;"></div>
        </div>
      </div>
    </div>

    <!-- SETTINGS OVERLAY -->
    <div id="settings-overlay" class="settings-overlay hidden">
      <div class="settings-nav">
        <h3 class="settings-title">‚öôÔ∏è Param√®tres</h3>
        <button id="btn-back-settings" class="round-btn" title="Retour">‚Üê</button>
      </div>
      
      <div class="settings-body">
        <!-- GEMINI CARD (V1 DESIGN) -->
        <div class="provider-card active-provider open">
          <!-- Header (cliquable pour r√©duire) -->
          <div class="provider-header" id="toggle-gemini-card">
            <div class="header-left">
              <span class="provider-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="url(#geminiGradient)"><defs><linearGradient id="geminiGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#4E86F0;stop-opacity:1" /><stop offset="100%" style="stop-color:#9B6EF3;stop-opacity:1" /></linearGradient></defs><path d="M12,2 L14,9 L21,11 L14,13 L12,20 L10,13 L3,11 L10,9 L12,2 Z" /><path d="M19,19 L20,16 L21,19 L24,20 L21,21 L20,24 L19,21 L16,20 L19,19 Z" /></svg>
              </span>
              <div class="provider-name">Google Gemini</div>
            </div>
            <div class="header-right">
              <div id="api-status" class="status-badge">Non connect√©</div>
              <span class="header-chevron" id="gemini-chevron">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
              </span>
            </div>
          </div>
          
          <!-- Contenu repliable -->
          <div id="gemini-card-content">
          
          <!-- Zone Config (Cl√© API) -->
          <div class="api-config-area">
            <div class="api-input-group">
              <label class="api-label">Cl√© API</label>
              <div class="api-input-wrapper">
                <input id="api-key-input" type="password" class="api-input" placeholder="Entrez votre cl√© API..." autocomplete="off">
                <button id="btn-save-api" class="btn-validate">Valider</button>
              </div>
              <!-- Message d'erreur -->
              <div id="api-error-msg" class="api-error-msg hidden"></div>
              <!-- Affichage cl√© configur√©e (vert avec X) -->
              <div id="configured-key-display" class="configured-key-display hidden">
                <span class="key-label">Votre cl√© :</span>
                <span id="key-masked" class="key-masked">AIzaSy********</span>
                <button id="btn-remove-api" class="btn-remove-key" title="Supprimer la cl√©">√ó</button>
              </div>
            </div>
            <a href="https://aistudio.google.com/app/apikey" target="_blank" class="api-help-link">Obtenir une cl√© Gemini gratuite ‚Üí</a>
          </div>

          <!-- Zone Mod√®le (Accord√©on) -->
          <div class="model-trigger-zone" id="model-trigger">
            <span id="current-model-name" class="current-model-text">‚ö° Analyse Rapide (Flash)</span>
            <div class="expand-arrow">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
            </div>
          </div>
          
          <!-- LISTE D√âROUL√âE -->
          <div id="model-list-dropdown" class="model-list-dropdown hidden">
            <div class="model-option selected" data-model="fast">
              <span>‚ö° Analyse Rapide (Flash)</span>
              <span class="check-icon">‚úì</span>
            </div>
            <div class="model-option" data-model="pro">
              <span>üß† Analyse Pro (Gemini Pro)</span>
              <span class="check-icon hidden">‚úì</span>
            </div>
          </div>
          </div> <!-- Fin gemini-card-content -->
        </div>

        <!-- AI TUNING CARD (R√©glage IA) -->
        <div class="provider-card open">
          <!-- Header -->
          <div class="provider-header" id="toggle-tuning-card">
            <div class="header-left">
              <span class="provider-logo" style="font-size: 20px;">üéöÔ∏è</span>
              <div class="provider-name">R√©glage de l'IA</div>
            </div>
            <div class="header-right">
              <span class="header-chevron" id="tuning-chevron">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
              </span>
            </div>
          </div>
          
            <!-- Content -->
            <div id="tuning-card-content">
                <div class="tuning-container" style="padding: 10px;">
                    <!-- New Preset Button -->
                    <div style="margin-bottom: 12px; text-align: center;">
                        <button id="btn-new-preset" class="btn-create" style="width:100%">+ Nouveau R√©glage</button>
                    </div>

                    <!-- Cards Container -->
                    <div id="preset-cards-container" class="jobs-scroll-area">
                        <!-- Injected by JS: .preset-card -->
                    </div>
                </div>
            </div> <!-- Fin tuning-card-content -->
        </div>

        <!-- √Ä PROPOS (Compact) -->
        <div class="about-footer">
          <span>Pawz v2.0</span>
          <span class="separator">‚Ä¢</span>
          <a href="#" class="about-link">Documentation</a>
        </div>
      </div>
    </div>

    <script src="sidepanel.js"></script>
  </body>
</html>
